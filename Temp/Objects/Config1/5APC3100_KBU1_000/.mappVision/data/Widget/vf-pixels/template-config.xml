<?xml version="1.0" encoding="UTF-8"?>
<VisionFunction Name="vf-pixels" HALCONPrefix="BR_pixel_counter" Version="5.1.0-rc.1"
	Compatibility="SmartCamera SmartSensor"
	xmlns="http://br-automation.com/2021/Vision/template-config_1.3.0.xsd">
    
    <Images>
        <!--TBD Ein Kontainer für Eingangsbilder oder mehrere einzelbilder?
			Result: Mehrere Kontainer für Eingang, potentiell Mehrere für Ausgänge	  
		Raw ist not a RestrictedHALCONType -->
        <Image Name="Image" NumberElements="1" Position="1" Access="rw" />
        <!--<OutputImage Name="OutputImage" Type="Raw"  Position="1" Access="rw" />-->
        
        <!-- Should every function provide an output or only functions that are allowed to modify the image data ? 
			Result: Nein, nur für potentiell änderliche Bilder-->
    </Images>
    
    <Capabilities>
        <Capability Function="Models"/>
        <Capability Function="ToolList">
            <ToolListReference Name="TL1">
                <Tool type="rectangle" operation="add" default="true" size="0.33" position="0.5"/>
                <Tool type="ellipse" operation="add" size="0.33" position="0.5"/>
                <Tool type="ring" operation="add" size="0.33" position="0.5"/>
                <Tool type="freehand" operation="add" size="0.33" position="0.5"/>
                <Tool type="rectangle" operation="remove" size="0.33" position="0.5"/>
                <Tool type="ellipse" operation="remove" size="0.33" position="0.5"/>
                <Tool type="ring" operation="remove" size="0.33" position="0.5"/>
                <Tool type="eraser" operation="remove" size="0.33" position="0.5"/>
            </ToolListReference>
        </Capability>
    </Capabilities>
    
    
    <!-- No acyclic parameters -->
    <ModelParameters>
        <ModelParameter Name="ThresholdMin" Group="ModelParams" Position="1"
			Type="integer" Widget="Default" Access="r" MinCount="1" MaxCount="1">
            <ValueRange Min="0" Max="255" />
        </ModelParameter>
        <ModelParameter Name="ThresholdMax" Group="ModelParams" Position="2"
			Type="integer" Widget="Default" Access="r" MinCount="1" MaxCount="1">
            <ValueRange Min="0" Max="255" />
        </ModelParameter>
        <!-- 'BOOL' is not supported in ModelParameters. -->
        <ModelParameter Name="InvertSelection" Group="ModelParams" Position="3"
			Type="integer" Widget="Default" Access="r" MinCount="1" MaxCount="1">
            <ValueRange Min="0" Max="1" />
        </ModelParameter>
        <ModelType Name="pixel counter model" Teachable="true" ModelRoi="required" Marker="prohibited">
            <Capabilities>
                <Capability Name="ToolListReference" Value="TL1" Type="ModelRoi"/>
                <Capability Name="IconicsPaintMode" Value="region" />
                <Capability Name="ToolInstances" Value="multi" />
                <Capability Name="OrientationTool" Value="false" />
            </Capabilities>
            <ModelParameterReference Name="ThresholdMin" />
            <ModelParameterReference Name="ThresholdMax" />
            <ModelParameterReference Name="InvertSelection" />
        </ModelType>
    </ModelParameters>
    <Variables>
        <!-- 
			 normal cyclic inputs 
		-->
        <Variable Name="Enable" Group="Vars" Position="1"
			Native="uint8_t" PLK="BOOL" Widget="Default" Role="Input">
            <Display Key="0" Value="false" />
            <Display Key="1" Value="true" />
            <Value>0</Value>
            <Value>1</Value>
        </Variable>
        <Variable Name="NumSearchMax" Group="Vars" Position="2"
			Native="uint8_t" PLK="USINT" Widget="Default" Role="Input">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <Variable Name="EnhancedPixelCounterInformation" Group="Vars" Position="4"
			Native="uint8_t" PLK="BOOL" Widget="Default" Role="Input">
            <Display Key="0" Value="false" />
            <Display Key="1" Value="true" />
            <Value>0</Value>
            <Value>1</Value>
        </Variable>
        <Variable Name="OffsetROIX" Group="Vars" Position="6"
			PLK="DINT" Native="double" Widget="Default" Role="Input" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <Variable Name="OffsetROIY" Group="Vars" Position="7"
			PLK="DINT" Native="double" Widget="Default" Role="Input" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <Variable Name="OffsetROIOrientation" Group="Vars" Position="8"
			PLK="INT" Native="double" Widget="Default" Role="Input"  UnitNS="http://www.opcfoundation.org/UA/units/un/cefact" UnitID="17476">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-17999" Max="18000" />
        </Variable>
        <Variable Name="OffsetROIRotCenterX" Group="Vars" Position="9"
			PLK="DINT" Native="double" Widget="Default" Role="Input" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <Variable Name="OffsetROIRotCenterY" Group="Vars" Position="10"
			PLK="DINT" Native="double" Widget="Default" Role="Input" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <!-- 
			 volatile cyclic inputs 
		-->
        <Variable Name="TestExecute" Group="Vars" Position="11"
			Native="uint8_t" PLK="BOOL" Widget="Default" Role="Volatile">
            <Display Key="0" Value="false" />
            <Display Key="1" Value="true" />
            <Value>0</Value>
            <Value>1</Value>
        </Variable>
        <!--
			 output variables (special and not special)
		-->
        <Variable Name="NumResults" Group="Vars" Position="105"
			PLK="USINT" Native="uint8_t" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- ModelNumber: 0 is the marker that there's no sensible results at this index -->
        <Variable Name="ModelNumber" Group="Vars" Position="106" NumberElements="NumResultsMax"
			PLK="USINT" Native="uint8_t" Size="1 * NumResultsMax" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- NumPixels: 0 is a valid result for a given model! -->
        <Variable Name="NumPixels" Group="Vars" Position="107" NumberElements="NumResultsMax"
			PLK="UDINT" Native="uint32_t" Size="4 * NumResultsMax" Widget="Default" Role="Output" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <ValueRange Min="0" Max="4294967296" />
        </Variable>
        <!-- MinGray[x] is 0 if ModelNumber[x] also is 0. Else, minimum value -->
        <Variable Name="MinGray" Group="Vars" Position="108" NumberElements="NumResultsMax"
			PLK="USINT" Native="uint8_t" Size="1 * NumResultsMax" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- MinGray[x] is 0 if ModelNumber[x] also is 0. Else, maximum value -->
        <Variable Name="MaxGray" Group="Vars" Position="109" NumberElements="NumResultsMax"
			PLK="USINT" Native="uint8_t" Size="1 * NumResultsMax" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- standard mean. i.e., [1, 3, 98]: mean is (1+3+98)/3 = 102/3 = 34 -->
        <Variable Name="MeanGray" Group="Vars" Position="110" NumberElements="NumResultsMax"
			PLK="UINT" Native="double" Size="2 * NumResultsMax" Widget="Default" Role="Output">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="0" Max="25500" />
        </Variable>
        <!-- expecting this to be the standard deviation -->
        <Variable Name="DeviationGray" Group="Vars" Position="111" NumberElements="NumResultsMax"
			PLK="UINT" Native="double" Size="2 * NumResultsMax" Widget="Default" Role="Output">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="0" Max="25500" />
        </Variable>
        <!-- standard median. i.e., [1, 3, 98]: median is the middle element, i.e., 3 -->
        <Variable Name="MedianGray" Group="Vars" Position="112" NumberElements="NumResultsMax"
			PLK="USINT" Native="uint8_t" Size="1 * NumResultsMax" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- discuss w/ @beinhundnerg - do we need this data point? It merely mirrors the
			 area of the ModelROI and will remain constant for a constant model throughout
			 the execution -->
        <Variable Name="ModelArea" Group="Vars" Position="113" NumberElements="NumResultsMax"
			PLK="UDINT" Native="uint32_t" Size="4 * NumResultsMax" Widget="Default" Role="Output" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <ValueRange Min="0" Max="255" />
        </Variable>
        <!-- if we see a max value here, i.e., 65535, this means we have >= 65535 connected
			components! -->
        <Variable Name="NumConnectedComponents" Group="Vars" Position="114" NumberElements="NumResultsMax"
			PLK="UINT" Native="uint16_t" Size="2 * NumResultsMax" Widget="Default" Role="Output">
            <ValueRange Min="0" Max="65535" />
        </Variable>
        <!-- this feels like a lot of data (8 bytes per result) for two positions. It was
			 removed in the spec v0.50. Discuss w/ @beinhundnerg what's up with this. -->
        <Variable Name="PositionX" Group="Vars" Position="115" NumberElements="NumResultsMax"
			PLK="DINT" Native="double" Size="4 * NumResultsMax" Widget="Default" Role="Output" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <Variable Name="PositionY" Group="Vars" Position="116" NumberElements="NumResultsMax"
			PLK="DINT" Native="double" Size="4 * NumResultsMax" Widget="Default" Role="Output" UnitNS="http://www.br-automation.com/units" UnitID="5261656">
            <LinearTransform Multiplicand="1" Divisor="100" InitialAddend="0" FinalAddend="0" />
            <ValueRange Min="-2622400" Max="2622400" />
        </Variable>
        <Variable Name="FunctionProcessingTime" Group="Vars" Position="104"
			PLK="UINT" Native="uint16_t" Widget="Default" Role="Output"
			UnitNS="http://www.opcfoundation.org/UA/units/un/cefact" UnitID="4403766">
            <ValueRange Min="0" Max="65535" />
        </Variable>
    </Variables>
    <Constants>
        <Constant Name="NumResultsMax" PLK="USINT" Native="uint8_t" Widget="Default"
			Group="Constants" Position="0" Offset="0">
            <ValueRange Min="1" Max="255" />
            <InitialDefault>20</InitialDefault>
        </Constant>
    </Constants>
    <!--
		 as we have no parameters, there is no "Params" group!
	-->
    <Groups>
        <Group id="ModelParams" Name="Model Parameters" />
        <Group id="Vars" Name="Process Variables of the Vision Function" />
        <Group id="Constants" Name="Vision Constants" />
    </Groups>
    <Distribution>
        <Shared>
            <XMLConfig Name="template-config.xml" />
            <ProcedureLibrary Name="BR_pixel_counter.hdpl" Encrypted="true" />
            <SharedLibrary Name="../vf-lib/BR_helper_procedures.hdpl" Encrypted="true" />
        </Shared>
        <Instance>
            <Constants Name="constants" FileSize="1" Type="vision constants" Presence="required constant" />
            <Params Name="params" FileSize="0" Type="vision parameters" Presence="unused" />
            <Models Name="models" Type="internal models" Presence="missing-ok updatable" />
            <Widget Name="widget" Type="teaching models" Presence="missing-ok updatable" />
            <ROI Name="roi.hobj" Type="region of interest" Presence="missing-ok updatable" />
            <Objects Name="sui.json" Type="object store" Presence="missing-ok updatable" />
        </Instance>
    </Distribution>
</VisionFunction>
